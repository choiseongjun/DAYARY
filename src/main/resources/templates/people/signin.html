<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"    
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<meta name="google-signin-scope" content="profile email">
<meta name="google-signin-client_id"
	content="	681877465979-hbu3jluica1eddcndkvl52n6h10jq6sf.apps.googleusercontent.com">
<title>Insert title here</title>
<css th:replace="layout/header::headerCss" />

</head>

<body>
	<div th:replace="layout/header::header" />
	
	<form th:action="@{/appLogin}">
	<div class="login_popup">
			<p class="popup_main_text"><span>프룻</span>에 오신 것을 환영합니다!</p>
	        <p class="popup_sub_text">
	        	<span>프룻</span>은 ~이러한 <br>
	플랫폼 서비스입니다.
	        </p>
	        <div class="btn_box">
	        	<a href="#"><img src="/publ/images/layout/google.png" alt="Fruit 로고">Google</a>
	            <a href="#"><img src="/publ/images/layout/facebook.png" alt="Fruit 로고">Facebook</a>
	        </div>
	        <ul class="input_login_box">
	        	<li><input type="text" name="email"  placeholder="이메일"></li>
	            <li><input type="password" name="password"  placeholder="비밀번호"></li>
	        </ul>
	        <input type="submit" class="login_btn" value="로그인"/>
	        <p th:if="${loginError}" class="error" style="color: red;">잘못된 아이디 또는 비밀번호입니다</p>
	       <p th:if="${code}" class="error" style="color: blue;" th:text="${message}"></p>
  <br>
	        <div class="footer_login_btn">
	<a href="#" class="join_btn">회원가입</a>
	            <a href="#" id="findFormbtn" class="find_login">비밀번호를 잊으셨다면</a>
	        </div>
	      
	</div>
	</form>
	<div class="login_popup" id="find">
		<p class="popup_main_text"><span>프룻</span>회원가입</p>
	        <p class="popup_sub_text">
	        	Fruit은 ~이러한<br>
	플랫폼 서비스입니다.
	        </p>
	  <div  class="input_login_box">
		        	해당 이메일로 임시비밀번호를 보내드립니다.<br/>
		        	 	 아이디 : <input type="text" id="emailFind"/> <br/>
		        	 	 <button id="find_btn" class="login_btn">전송</button>
		      	  </div>
	</div>
	<form  name="signUp" action="/signup" method="POST" enctype='multipart/form-data'>
	<div class="find_login_popup">
			<p class="popup_main_text"><span>프룻</span>회원가입</p>
	        <p class="popup_sub_text">
	        	Fruit은 ~이러한<br>
	플랫폼 서비스입니다.
	        </p>
	        <div class="btn_box">
	        	<a href="#"><img src="/publ/images/layout/google.png" alt="Fruit 로고">Google</a>
	            <a href="#"><img src="/publ/images/layout/facebook.png" alt="Fruit 로고">Facebook</a>
	        </div>
	        <ul class="input_login_box">
	        	<li><input type="email" id="email" name="email" placeholder="이메일"></li>
	            <li><input type="password" id="password" name="password"  placeholder="비밀번호"></li>
	            <li><input type="password" id="passwordCk" placeholder="비밀번호 확인"></li>
	        </ul>
	        <div class="join_chk_box">
	        		<input type="checkbox" name="joinChk" id="join_chk"class="cb2"><label for="join_chk"></label>
	                <p><span>프룻</span> 이용약관 및 <span>개인정보취급방침</span>에 동의합니다.</p>
	        </div>
	     		      <a href="#" class="login_btn" id="finish_join">회원가입</a>
	        <div class="footer_login_btn">
	        	<a href="#" class="back_loing finish_join">로그인화면으로 가기</a>
	        </div>
	</div>
	
	
	<div class="my_type_popup">
			<p class="popup_main_text"><span>당신을 알려주세요</span></p>
	        <p class="popup_sub_text">
	        	‘닉네임’의 관심사에 맞게 <br>
	프룻이 추천해드릴게요!
	        </p>
	          <ul class="input_login_box">
	        	<li><input type="text" id="name" name="name" placeholder="닉네임"></li>
	     	   </ul>
	        <ul class="my_type_cho_ul">
	        	<li>
	            	<p>성별</p>
	                 <select id="sex" name="sex" class="select_pp" >
	                     <option value="F">여자</option>
	                     <option value="F">여자</option>
	                     <option value="M">남자</option>
	                  </select>
	            </li>
	            <li>
	            	<p>직업</p>
	                 <select id="job" name="job" class="select_pp" >
	                     <option value="0">직업1</option>
	                     <option value="0">직업1</option>
	                     <option value="1">직업3</option>
	                  </select>
	            </li>
	            <li>
	            	<p>관심사</p>
	                  <span th:each="list : ${interests}" th:if="${list.commName !='전체'}">
	               	   <input type="checkbox"  name="interest" th:value="${list.commCode}">
	               	   <span th:text="${list.commName}"></span>
	                  </span>
	                <input type="hidden" name="interests" id="interests">
	                  
	            </li>
	        </ul>
	        <a href="#" class="login_btn join_go_btn">완료!</a>
	
	</div>
     <!--        User Name : <input type="text" name="email"/> <br/><br/>
            Password: <input type="password" name="password"/> <br/><br/>
            <input type="submit" value="Login"/>
        -->
    </form> 
	<input type="hidden" id="authMessage" th:value="${authMessage}">
<!-- 	<script src="/js/people/signin.js"></script> -->
	<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<script type="text/javascript"
		src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js"
		charset="utf-8"></script>
	
	<script>
	$(document).ready(function(){
		$(".login_popup").show()
		if($("#authMessage").val()){
			alert($("#authMessage").val());	
			}
			$("#find").toggle();
		});
	$("#find_btn").click(function(){
			 $.ajax({
			      url:'/auth/findPassword/'+$("#emailFind").val(),		
			      processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			      contentType: "application/json; charset=utf-8",
			        processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			        success:function(data){
			        	if(data.code=='1'){
			        		alert(data.message);
			        		$("#find").toggle();
			        		$(".login_popup").show();
			        		
			        	}
			        }
			        	
			        });
			
		});
		  
	$("#findFormbtn").click(function(){
		$(".login_popup").toggle();
		$("#find").toggle();
		})
	$(".open_login_popup").click(function(){
		$(".login_popup").show()
		
		})
	$(".join_go_btn").click(function(){
			if($("#name").val()==""){
				alert("닉네임을 입력하세요.");
				return;
			}
			 $.ajax({
			      url:'/auth/checkName/'+$("#name").val(),		
			      processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			      contentType: "application/json; charset=utf-8",
			        processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			        async: false,
			        success:function(data){
			        	if(data.code=="true"){
			        		alert(data.message);
			        		$("#name").val("");
				        	flag= false;
			        		
			        	}else
			        		flag=true;
			        }
			        	
			        });
				if(flag){
					if($("input[name=interest]:checked").length==0){
						alert("관심사를 체크해주세요.");
						return;
					}
					
					//관심사들 모아서 값 설정
					var interests="";
					$("input[name=interest]:checked").each(function(i){

						interests+=$(this).val()+",";

						});
					$("#interests").val(interests.slice(0,-1));
					$(".my_type_popup").toggle()
					$(".find_login_popup").show()
				}
		
		
		})	
	$(".join_btn").click(function(){
			$(".login_popup").toggle()
			$(".my_type_popup").show()
		
		})
	$(".finish_join").click(function(){
			$(".find_login_popup").toggle()
		
		})

	$("#finish_join").click(function(){
		//비밀번호 확인과 비밀번호 일치 체크
		var email = $("#email").val();
		var exptext =  /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;

		if(email.match(exptext)==null){

		//이메일 형식이 알파벳+숫자@알파벳+숫자.알파벳+숫자 형식이 아닐경우			
		alert("이 메일형식이 올바르지 않습니다.");
		return;
		}
		//메일 존재할경우 code가 true되고 flag false되서 return
			 $.ajax({
			      url:'/auth/checkEmail/'+$("#email").val(),		
			      processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			      contentType: "application/json; charset=utf-8",
			        processData: false, //데이터를 쿼리 문자열로 변환하는 jQuery 형식 방지
			        async: false,
			        success:function(data){
			        	if(data.code=="true"){
			        		alert(data.message);
			        		$("#email").val("");
							flag=false;
			        	}else
			        		flag=true;
			        }
			        	
			        });
		
		if(flag){ 
			if($("#password").val()!=$("#passwordCk").val()){
			alert("비밀번호와 비밀번호 확인이 일치하지 않습니다");
			$("#passwordCk").val("");
			return;
		}else	if($("input[name=joinChk]:checked").length==0){
			alert("이용약관에 동의하여야 이용가능합니다:(");
			return;
		}
		
		        	document.signUp.submit();
			
		}		
		
		})
		/* 구글 */
		function onSignIn(googleUser) {
			// Useful data for your client-side scripts:
			var profile = googleUser.getBasicProfile();
			console.log("ID: " + profile.getId()); // Don't send this directly to your server!
			console.log('Full Name: ' + profile.getName());
			console.log('Given Name: ' + profile.getGivenName());
			console.log('Family Name: ' + profile.getFamilyName());
			console.log("Image URL: " + profile.getImageUrl());
			console.log("Email: " + profile.getEmail());

			// The ID token you need to pass to your backend:
			var id_token = googleUser.getAuthResponse().id_token;
			console.log("ID Token: " + id_token);
		}

		/* 카카오 */
		// 사용할 앱의 JavaScript 키를 설정해 주세요.
		Kakao.init('8eb21286f0a69d0886357dbf7994d836');
		// 카카오 로그인 버튼을 생성합니다.
		Kakao.Auth.createLoginButton({
			container : '#kakao-login-btn',
			success : function(authObj) {
				Kakao.API.request({

					url : '/v1/user/me',

					success : function(res) {
						//로그인 성공 알림창 띄우고 메인화면으로 parameter 가지고 넘어가고 db에 id 저장

						alert(JSON.stringify(res)); //<---- kakao.api.request 에서 불러온 결과값 json형태로 출력

						alert(JSON.stringify(authObj)); //<----Kakao.Auth.createLoginButton에서 불러온 결과값 json형태로 출력

						console.log(res.id);//<---- 콘솔 로그에 id 정보 출력(id는 res안에 있기 때문에  res.id 로 불러온다)

						console.log(res.kaccount_email);//<---- 콘솔 로그에 email 정보 출력 (어딨는지 알겠죠?)

						console.log(res.properties['nickname']);//<---- 콘솔 로그에 닉네임 출력(properties에 있는 nickname 접근 

						// res.properties.nickname으로도 접근 가능 )

						console.log(authObj.access_token);//<---- 콘솔 로그에 토큰값 출력

					}
				})

				alert(JSON.stringify(authObj));
			},
			fail : function(err) {
				alert(JSON.stringify(err));
			}
		});
		//소셜 로그인
		$('.btn_social').click(function() {
			var socialType = $(this).data('social');
			location.href = "/oauth2/authorization/" + socialType;
		});
	</script>
</body>
</html>